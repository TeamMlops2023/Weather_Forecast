pipeline {
    agent any

    stages {
        stage('Checkout SCM') {
            steps {
                // Checkout your source code from Git repository
                checkout scm
            }
        }

        stage('Start Database') {
            steps {
                script {
                    // Start MySQL container
                    def mysqlContainer = docker.image('mysql:5.7').run(
                        "-d", "--name", "mysql-container",
                    "-e", "MYSQL_ROOT_PASSWORD=mysecretpassword",
                    "-e", "MYSQL_DATABASE=mlops_weather",
                    "-p", "3306:3306"
            )
            echo 'Démarrage du conteneur de la base de données réussi.'
            // Attendre que la base de données soit prête
            sh 'sleep 30'
                }
            }
        }

        // Ajoutez ici les autres étapes de votre pipeline
        // Par exemple, étapes pour construire, tester et déployer votre application.

    }

    post {
        always {
            // Arrêtez et supprimez le conteneur Docker MySQL
            script {
                def mysqlContainer = docker.image('mysql:5.7')
                mysqlContainer.stop()
                mysqlContainer.remove()
            }
        }
    }
}
