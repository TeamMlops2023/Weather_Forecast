pipeline {
    agent any

    stages {
        stage('Start Database') {
            steps {
                script {
                    // Démarrage du conteneur de base de données
                    mysqlContainer = docker.image('mysql:5.7').run('-d -e MYSQL_ROOT_PASSWORD=mysecretpassword -e MYSQL_DATABASE=mlops_weather -p 3306:3306 --name mysql-container')
                    // Attendre que la base de données soit prête
                    sh 'sleep 30'
                }
            }
        }

        stage('Test Database') {
            steps {
                script {
                    // Exécution des tests de la base de données
                    sh "docker exec mysql-container python /path/to/tests/test_database.py"
                }
            }
        }

        stage('Cleanup') {
            steps {
                script {
                    // Nettoyage : Arrêter et supprimer le conteneur de la base de données
                    sh "docker stop mysql-container || true"
                    sh "docker rm mysql-container || true"
                }
            }
        }
    }
}
