pipeline {
    agent any

    stages {
        stage('Build Docker Image') {
            steps {
                script {
                    // Construisez l'image Docker du modèle de machine learning
                    mlContainer = docker.build('ml-model-image', './chemin_vers_dossier_machine_learning')
                }
            }
        }

        stage('Run Container and Test') {
            steps {
                script {
                    // Démarrer le conteneur et exécuter des tests basiques
                    mlContainer.run('-d --name ml-test-container')
                    sh 'sleep 10' // Donnez un peu de temps pour le démarrage du conteneur
                    // Ici, vous pouvez exécuter des commandes pour tester le conteneur
                    // Par exemple, vérifier que Python est installé, exécuter un script simple, etc.
                }
            }
        }

        stage('Cleanup') {
            steps {
                script {
                    // Nettoyage : Arrêter et supprimer le conteneur de test
                    sh 'docker stop ml-test-container || true'
                    sh 'docker rm ml-test-container || true'
                }
            }
        }
    }
}
